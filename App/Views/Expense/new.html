{% extends "base.html" %}

{% block title %}New expense{% endblock %}

{% block footer %}

<script src="/js/hideShowPassword.min.js"></script>
<script src="/js/app.js"></script>
    

<script>
      /*
        $(document).ready(function() {
            
            $('#formSignup').validate({
                rules: {
                    amount: {
                        required: true,
                        number: true,
                        remote: '/account/validate-limit'
                    }
                    
                },
                messages: {
                    amount: {
                    remote: 'Monthly limit exceeded'
                    }
                }    
    
            });
        });
*/

const getDataForLimit = () => {
   // const data = document.getElementById('inputCategory').value;

    const data = {};
     data.category = document.getElementById('inputCategory').value;
     data.amount = document.getElementById('amount').value;
     data.date = document.getElementById('inputDate').value;

    fetch('/Account/validate-limit', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success', data);
        if (data) {
        document.getElementById('response').innerHTML = "Warning! Monthly limit exceeded";
    } 
        else document.getElementById('response').innerHTML = ""
    })
    .catch((error) => {
        console.error('Error', error);
    });
}

</script>

{% endblock %}

{% block body %}
    

    
<div class="welcome-container">
    <h1>Add new expense</h1>
    {% if expenseModel.errors is not empty %}
    <p> Errors:</p>
    <ul>
        {% for error in expenseModel.errors %}
        <li> {{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}


    <form method="post" action="/expense/create" id="formSignup">

        <div class="form-group">
            <label for="inputCategory">Category</label>
            <select onchange="getDataForLimit()" id="inputCategory" name="category" required class="form-control">
                {% for expense in expenses %}
                <option>{{ expense.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="amount">Amount ({{ current_user.currency }})</label>
            <input onchange="getDataForLimit()" id="amount" type="text" autofocus required class="form-control" name="amount" placeholder="Insert expense amount" />

        </div>


        <div class="form-group">
            <label for="inputMethod">Payment method</label>
            <select id="inputMethod" name="method" required class="form-control">
                {% for method in methods %}
                <option>{{ method.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="inputDate">Date</label>
            <input onchange="getDataForLimit() "id="inputDate" type="date" value='{{ "now"|date("Y-m-d") }}' required class="form-control" name="date"/>
        </div>

        <div class="form-group">
            <label for="inputComment">Comment</label>
            <textarea id="inputComment" name="comment" class="form-control"></textarea>
        </div>

        <br /><div id="response"></div>

        <br /><button type="submit" class="btn btn-primary">Add expense</button>

    </form>
</div>

{% endblock %}
